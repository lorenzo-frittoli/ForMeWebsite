{% extends "layout.html" %}

{% block title %}
    Me
{% endblock %}

{% block main %}
    <!-- Makes a warning appear if you have already booked this course -->
    <script>
        $(document).ready(function() {
            schedule = JSON.parse('{{ schedule|tojson }}');

            // Check every title to spot empty spots
            for (const day of Object.values(schedule)) {
                for (const data of Object.values(day)) {
                    if (data[0] === "") {
                        // If there are empty spots, display a warning
                        $(".warning").css("display", "block");
                        return;
                    }
                }
            }
        });
    </script>

    <h3 class="warning">CI SONO POSTI NON PRENOTATI</h3>
    <h1>Il Mio Orario</h1>
    {% if user_type != "staff" %}
        <h5>{{ session["user_name"] }} {{ session["user_surname"] }}</h5>
        <p>{{ session["user_email"] }}</p>
        <div class="mb-3" style="margin: 2rem 5%;">
            <table class="table table-striped" id="table-desktop">
                <thead>
                    <th> </th>
                    {% for timespan in schedule.values()|first %}
                    <th>{{ timespan }}</th>
                    {% endfor %}
                </thead>
                {% for day, bookings in schedule.items() %}
                <tr>
                    <th>{{ day }}</th>
                    {% for title, link in bookings.values() %}
                        {% if title == "" %}
                            <td style="color: rgb(117, 117, 117);">Vuoto</td>
                        {% else %}
                            <td><a href="{{ link }}">{{ title }}</a></td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
            <table class="table table-striped" id="table-mobile">
                <thead>
                    <th> </th>
                    {% for day, bookings in schedule.items() %}
                    <th>{{ day }}</th>
                    {% endfor %}
                </thead>
                {% for timespan in schedule.values()|first %}
                <tr>
                    <th>{{ timespan }}</th>
                    {% for day, bookings in schedule.items() %}
                        {% if schedule[day][timespan][0] == "" %}
                            <td style="color: rgb(117, 117, 117);">Vuoto</td>
                        {% else %}
                            <td><a href="{{ schedule[day][timespan][1] }}">{{ schedule[day][timespan][0] }}</a></td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
    {% else %}
        Gli account di tipo staff non hanno un orario
    {% endif %}
{% endblock %}
